<div class="data-source-table" #dataSourceTable cdkDragBoundary=".mat-card-content-report" cdkDrag
  [style.width]="table.width+'%'">
  <div class="movement-line" cdkDragHandle></div>
  <span class="mx-1 left-move-icon" cdkDragHandle>
    <i class="fa-solid fa-up-down-left-right"></i>
  </span>
  <h3 class="table-title" *ngIf="table.title">{{table.title}}</h3>
  <span class="table-number">{{tableNumber}}</span>
  <div class="icon-container">
    <div class="d-flex align-items-center">
      <!-- delete element icon -->
      <span class="mx-1 element-remove-icon" (click)="confirmationDeleteTextBox($event)">
        <i class="fa-solid fa-xmark"></i>
      </span>
      <!-- edit element icon -->
      <span class="mx-1 element-add-icon" (click)="showDialogToAdd()">
        <i class="fa-solid fa-plus"></i>
      </span>
      <!-- edit element icon -->
      <span class="mx-1 element-move-icon" cdkDragHandle>
        <i class="fa-solid fa-up-down-left-right"></i>
      </span>
    </div>
  </div>
  <p-table #dt class="h-100" [columns]="selectedColumns" [value]="reports" [resizableColumns]="true"
    [reorderableColumns]="true" [responsive]="true" selectionMode="single" [(selection)]="selectedReport"
    (onRowSelect)="onRowSelect($event)">
    <ng-template pTemplate="header" let-columns>
      <tr>
        <th *ngFor="let col of columns" class="text-center" [pSortableColumn]="col.field" pResizableColumn
          pReorderableColumn [style.padding]="cellPadding+'px'" [style.fontSize]="table.thFontSize+'px'">
          {{col.header}}
          <p-sortIcon [field]="col.field" ariaLabel="Activate to sort"
            ariaLabelDesc="Activate to sort in descending order"
            ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-rowData let-columns="columns" let-index="rowIndex">
      <tr [pReorderableRow]="index" [pSelectableRow]="rowData">
        <td *ngFor="let col of columns" class="text-center" pReorderableRowHandle [style.padding]="table.padding+'px'"
          [style.fontSize]="table.tdFontSize+'px'">
          <div *ngIf="col.field == 'image'; else colData">
            <img [src]="rowData[col.field]" alt="img" width="50">
          </div>
          <ng-template #colData>{{rowData[col.field]}}</ng-template>

        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="summary" class="text-right">
      <p class="text-right mb-0 d-block w-100" dir="ltr"> المجموع الكلى {{reports?.length}}</p>
    </ng-template>
  </p-table>
  <div class="aggregate-container" *ngIf="functionSelected.length != 0">
    <app-aggregate [functions]="functionSelected" [reports]="reports"></app-aggregate>
  </div>
</div>


<p-dialog header="تعديل الصف" [(visible)]="displayDialog" [responsive]="true" showEffect="fade" [modal]="true"
  [style]="{width: '550px',zIndex:999900000000000}">
  <div class="p-grid ui-fluid p-4" *ngIf="report" dir="rtl" style="height: 300px;">
    <div *ngFor="let col of cols">

      <div class="form-group">
        <input type="text" placeholder=" " [id]="col.field+'-id'" [(ngModel)]="report[col.field]">
        <label [for]="col.field+'-id'">{{col.field}}</label>
      </div>

    </div>
  </div>
  <p-footer>
    <div class="ui-dialog-buttonpane ui-helper-clearfix">
      <button type="button" (click)="delete()" *ngIf="!AddDialog" class="btn btn-danger btn-sm">حذف</button>
      <button type="button" (click)="save()" class="btn btn-warning btn-sm">حفظ</button>
    </div>
  </p-footer>
</p-dialog>

<ng-template #settings>
  <div class="table-settings w-100 animate__animated  animate__flipInX">
    <a class="collabse-btn" data-toggle="collapse" [href]="'#'+settingsId" role="button" aria-expanded="false"
      aria-controls="collapseExample">
      اعدادات الجدول {{this.tableNumber}}
    </a>

    <div class="collapse" [id]="settingsId">
      <div class="card card-body">
        <div class="row">
          <div class="col-12">
            <div class="form-group text-right">
              <input type="text" id="tableWidthChanger" placeholder=" " [(ngModel)]="table.title">
              <label for="tableWidthChanger">عنوان الجدول</label>
            </div>
          </div>
          <!-- header height -->
          <div class="col-6">
            <div class="form-group text-right">
              <input type="number" id="tableWidthChanger" placeholder=" " min="50%" max="100" [(ngModel)]="table.width">
              <label for="tableWidthChanger">عرص الجدول</label>
            </div>
          </div>
          <div class="col-6">
            <div class="btn-group">
              <button type="button" class="export-dropdown" data-toggle="dropdown" aria-expanded="false">
                Exports
                <i class="fa-solid fa-caret-down"></i>
              </button>
              <div class="dropdown-menu dropdown-menu-center">
                <button class="dropdown-item" type="button" (click)="exportPdf()">Export PDF</button>
                <button class="dropdown-item" type="button" (click)="exportExcel()">Export EXCEL</button>
              </div>
            </div>
          </div>
          <div class="col-12">
            <!-- border radius -->
            <div class="form-group">
              <input type="range" class="form-control-range" id="tablePaddingChanger" [(ngModel)]="table.padding"
                min="1" max="30" step="1">
              <label for="tablePaddingChanger">حواف خلاياالجدول</label>

            </div>
          </div>
          <div class="col-12">
            <!-- border radius -->
            <div class="form-group">
              <input type="range" class="form-control-range" id="thFontChanger" [(ngModel)]="table.thFontSize" min="10"
                max="30" step="1">
              <label for="thFontChanger">حجم خط العنوان</label>
            </div>
          </div>
          <div class="col-12">
            <!-- border radius -->
            <div class="form-group">
              <input type="range" class="form-control-range" id="tdFontChanger" [(ngModel)]="table.tdFontSize" min="10"
                max="30" step="1">
              <label for="tdFontChanger">حجم خط الخلايا</label>
            </div>
          </div>
          <!-- determine show columns -->
          <div class="col-12">
            <div class="table-collabse-determine my-2">
              <label for="showColumns" class="text-right w-100">اختر الاعمدة المراد عرضها</label>
              <p-multiSelect id="showColumns" [options]="cols" [(ngModel)]="selectedColumns" optionLabel="header"
                selectedItemsLabel="{0} عدد الاعمدة" [style]="{minWidth: '200px'}" defaultLabel="اختر الاعمدة">
              </p-multiSelect>
            </div>
          </div>
          <div class="col-12">
            <!-- filter columm -->
            <div class=" animate__animated animate__headShake table-collabse-filter my-2 ui-rtl text-right" dir="rtl">
              <button class="btn btn-primary btn-sm mx-1" (click)="createNewFilter()">اضافه تنقيه</button>
              <button class="btn btn-primary btn-sm mx-1" (click)="createNewFunction()">اضافه داله</button>
              <div class="filter-container-template">
                <ng-template #filterContainer class="filter-container">-

                </ng-template>
              </div>
              <div class="filter-container-template">
                <ng-template #functionContainer class="function-container">

                </ng-template>
              </div>
            </div>
          </div>
        </div>


      </div>
    </div>

  </div>

</ng-template>