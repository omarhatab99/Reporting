<div class="data-source-table" #dataSourceTable cdkDragBoundary=".card-content-report" cdkDrag
  [style.width]="table.width+'%'">
  <div class="movement-line" cdkDragHandle></div>
  <span class="mx-1 left-move-icon" cdkDragHandle>
    <i class="fa-solid fa-up-down-left-right"></i>
  </span>
  <p class="table-title" *ngIf="table.title">{{table.title}}</p>
  <span class="table-number">{{tableNumber}}</span>
  <div class="icon-container">
    <div class="d-flex align-items-center">
      <!-- delete element icon -->
      <span class="mx-1 element-remove-icon" (click)="confirmationDeleteTable($event)">
        <i class="fa-solid fa-xmark"></i>
      </span>
      <!-- edit element icon -->
      <span class="mx-1 element-move-icon" cdkDragHandle>
        <i class="fa-solid fa-up-down-left-right"></i>
      </span>
    </div>
  </div>
  <p-table #dt class="h-100" [columns]="selectedColumns" [value]="reports" [resizableColumns]="true"
    [reorderableColumns]="true" [responsive]="true" selectionMode="single" [(selection)]="selectedReport">
    <ng-template pTemplate="header" let-columns>
      <tr>
        <th *ngFor="let col of columns" class="text-center" [pSortableColumn]="col.field" pResizableColumn
          pReorderableColumn [style.padding]="table.cellPadding+'px'" [style.fontSize]="table.thFontSize+'px'">
          {{col.header}}
          <p-sortIcon [field]="col.field" ariaLabel="Activate to sort"
            ariaLabelDesc="Activate to sort in descending order"
            ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-rowData let-columns="columns" let-index="rowIndex">
      <tr [pReorderableRow]="index" [pSelectableRow]="rowData">
        <td *ngFor="let col of columns" class="text-center" pReorderableRowHandle [style.padding]="table.padding+'px'"
          [style.fontSize]="table.tdFontSize+'px'">
          <div *ngIf="col.field == 'image'; else colData">
            <img [src]="rowData[col.field]" alt="img" width="50">
          </div>
          <ng-template #colData>{{rowData[col.field]}}</ng-template>

        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="summary" class="text-right">
      <p class="text-right mb-0 d-block w-100" dir="ltr"> المجموع الكلى {{reports?.length}}</p>
    </ng-template>
  </p-table>
  <div class="aggregate-container" *ngIf="functionSelected.length != 0">
    <app-aggregate [functions]="functionSelected" [reports]="reports"></app-aggregate>
  </div>
</div>

<!-- this template will be rendered at report component in spicific place -->
<ng-template #settings>
  <div class="table-settings w-100 animate__animated  animate__flipInX">
    <a class="collabse-btn w-100 d-flex justify-content-between align-items-center" data-toggle="collapse" [href]="'#'+settingsId" role="button" aria-expanded="false"
      aria-controls="collapseExample" style="background-color: aliceblue;">
      <span class="d-inline-block">
        <span class="table-icon-settings ml-2">
          <i class="fa-solid fa-table" style="color: #8a8a8a;"></i>
        </span>
        اعدادات الجدول {{this.tableNumber}}
      </span>
      <span>
        <button class="btn btn-outline-danger btn-sm" style="padding: 0px 10px;" (click)="confirmationDeleteTable($event)">حذف</button>
      </span>
    </a>

    <div class="collapse" [id]="settingsId">
      <div class="card card-body">
        <div class="row">
          <div class="col-12">
            <div class="form-group text-right">
              <input type="text" id="tableWidthChanger" placeholder=" " [(ngModel)]="table.title">
              <label for="tableWidthChanger">عنوان الجدول</label>
            </div>
          </div>
          <!-- table width -->
          <div class="col-6">
            <div class="form-group text-right">
              <input type="number" id="tableWidthChanger" placeholder=" " min="50%" max="100" [(ngModel)]="table.width">
              <label for="tableWidthChanger">عرص الجدول</label>
            </div>
          </div>
          <div class="col-6">
            <!-- export table -->
            <div class="btn-group">
              <button type="button" class="export-dropdown" data-toggle="dropdown" aria-expanded="false">
                Exports
                <i class="fa-solid fa-caret-down"></i>
              </button>
              <div class="dropdown-menu dropdown-menu-center">
                <button class="dropdown-item" type="button" (click)="exportPdf()">Export PDF</button>
                <button class="dropdown-item" type="button" (click)="exportExcel()">Export EXCEL</button>
              </div>
            </div>
          </div>
          <div class="col-12">
            <!-- table padding -->
            <div class="form-group">
              <input type="range" class="form-control-range" id="tablePaddingChanger" [(ngModel)]="table.padding"
                min="1" max="30" step="1">
              <label for="tablePaddingChanger">حواف خلاياالجدول</label>

            </div>
          </div>
          <div class="col-12">
            <!-- table header font size -->
            <div class="form-group">
              <input type="range" class="form-control-range" id="thFontChanger" [(ngModel)]="table.thFontSize" min="10"
                max="30" step="1">
              <label for="thFontChanger">حجم خط العنوان</label>
            </div>
          </div>
          <div class="col-12">
            <!-- table data font size -->
            <div class="form-group">
              <input type="range" class="form-control-range" id="tdFontChanger" [(ngModel)]="table.tdFontSize" min="10"
                max="30" step="1">
              <label for="tdFontChanger">حجم خط الخلايا</label>
            </div>
          </div>
          <!-- determine show columns -->
          <div class="col-12">
            <div class="table-collabse-determine my-2">
              <label for="showColumns" class="text-right w-100">اختر الاعمدة المراد عرضها</label>
              <p-multiSelect id="showColumns" [options]="cols" [(ngModel)]="selectedColumns" optionLabel="header"
                selectedItemsLabel="{0} عدد الاعمدة" [style]="{minWidth: '200px'}" defaultLabel="اختر الاعمدة">
              </p-multiSelect>
            </div>
          </div>
          <div class="col-12">
            <!-- filter columm -->
            <div class=" animate__animated animate__headShake table-collabse-filter my-2 ui-rtl text-right" dir="rtl">
              <button class="btn btn-primary btn-sm mx-1" (click)="createNewFilter()">اضافه تنقيه</button>
              <button class="btn btn-primary btn-sm mx-1" (click)="createNewFunction()">اضافه داله</button>
              <div class="filter-container-template">
                <ng-template #filterContainer class="filter-container">-

                </ng-template>
              </div>
              <div class="filter-container-template">
                <ng-template #functionContainer class="function-container">

                </ng-template>
              </div>
            </div>
          </div>
        </div>


      </div>
    </div>

  </div>

</ng-template>